<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<!-- <meta http-equiv="Cache-Control" content="no-cache"/>
	<meta http-equiv="Expires" content="-1"/>
	<meta http-equiv="Pragma" content="no-cache"/> -->
	<title>cesium</title>
	<link rel="stylesheet" href="/sample/style.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans"> 
	<link rel="stylesheet" href="/sample/homepage-demo.css?version=1" />
	<link rel="stylesheet" href="/src/engine/cesium/Widgets/widgets.css" />
	
	<link rel="stylesheet" href="/thirdparty/jquery-ui/jquery-ui.css" />
	<link rel="stylesheet" href="/thirdparty/jquery-toast/jquery.toast.css" />
	<script type="text/javascript" src="/thirdparty/jquery/jquery.js"></script>
	<script type="text/javascript" src="/thirdparty/jquery-ui/jquery-ui.js"></script>
	<script type="text/javascript" src="/thirdparty/jquery-toast/jquery.toast.js"></script>
</head>

<body>
	<div class="trigger" >
		<button type="button"></button>
		<ul>
			<li><a href="/homepage/index.do">Home</a></li>
			<li><a href="/homepage/about.do">Mago3D</a></li>	
			<li><a href="/homepage/download.do">Download</a></li>
			<li><a href="/homepage/tutorials.do">Tutorials</a></li>
		</ul>
	</div>
	<div class="ctrl">
		<div>
			<button id="issueEnable">Issue 등록</button>
			<button id="objectInfoEnable">Object 정보</button>	
			<button id="issuesEnable">Issues 표시</button>
			<input type="hidden" id="now_latitude" name="now_latitude" value="37.58070994202406" />
			<input type="hidden" id="now_longitude" name="now_longitude" value="126.88996581264895"  />
		</div>
		<ul class="tab">
			<li id="issueMoreImage">My Issue</li>
			<li id="apiMoreImage">API목록</li>
		</ul>
		<ul id="recentIssueListContent" class="issue" style="display: none">
			<li>
				<p class="title">
					2</p>
				<p class="info">
					<span class="tag i2">개선</span>
					<span class="tag t2">보통</span>
					<span>[3DS]</span>
					<button type="button" title="바로가기" onclick="flyTo('92', 'IMPROVE', '126.89222787907022', '37.579201027091806', '59.942467783873596', '2')">바로가기</button>
					<span class="date">2017-07-14 16:25:40</span>
				</p>
			</li>
			<li>
				<p class="title">
					1</p>
				<p class="info">
					<span class="tag i1">버그</span>
					<span class="tag t1">긴급</span>
					<span>[3DS]</span>
					<button type="button" title="바로가기" onclick="flyTo('91', 'BUGGER', '126.89223584621833', '37.57919616044298', '51.50571434478714', '2')">바로가기</button>
					<span class="date">2017-07-14 16:03:45</span>
				</p>
			</li>
			<li>
				<p class="title">
					1</p>
				<p class="info">
					<span class="tag i1">버그</span>
					<span class="tag t1">긴급</span>
					<span>[3DS]</span>
					<button type="button" title="바로가기" onclick="flyTo('90', 'BUGGER', '126.88985686761893', '37.581318740521496', '49.24999164742479', '2')">바로가기</button>
					<span class="date">2017-07-14 15:31:10</span>
				</p>
			</li>
			<li>
				<p class="title">
					a</p>
				<p class="info">
					<span class="tag i1">버그</span>
					<span class="tag t1">긴급</span>
					<span>[IFC]</span>
					<button type="button" title="바로가기" onclick="flyTo('89', 'BUGGER', '126.92742586024636', '37.52079763302676', '66.06677612119135', '2')">바로가기</button>
					<span class="date">2017-07-14 15:21:00</span>
				</p>
			</li>
			<li>
				<p class="title">
					555</p>
				<p class="info">
					<span class="tag i1">버그</span>
					<span class="tag t1">긴급</span>
					<span>[3DS]</span>
					<button type="button" title="바로가기" onclick="flyTo('88', 'BUGGER', '126.8890364749291', '37.57994153741642', '52.95577447262039', '2')">바로가기</button>
					<span class="date">2017-07-14 11:19:44</span>
				</p>
			</li>
		</ul>

		<div id="apiListContent" style="display: none">
			<div style="height: 20px;"></div>
			<div>
				<span style="padding-left: 10px; padding-right: 100px;">Data Key</span>
				<input type="text" id="search_data_key" name="search_data_key" size="15" />
				<button type="button" id="searchData" style="width: 50px; background: #727272; font-size: 1.2rem;">검색</button>
			</div>
			<div style="margin-top: 15px;">
				<span style="padding-left: 10px; padding-right: 70px;">Bounding Box</span>
				<input type="radio" id="showBoundingBox" name="boundingBox" value="true" onclick="changeBoundingBox(true);" />
				<label for="showBoundingBox"> 표시 </label>
				<input type="radio" id="hideBoundingBox" name="boundingBox" value="false" onclick="changeBoundingBox(false);"/>
				<label for="hideBoundingBox"> 비표시 </label>
			</div>
			<div style="margin-top: 15px;">
				<span style="padding-left: 10px; padding-right: 16px;">Selecting And Moving</span>
				<input type="radio" id="mouseNoneMove" name="mouseMoveMode" value="2" onclick="changeMouseMove('2');"/>
				<label for="mouseNoneMove"> None </label>
				<input type="radio" id="mouseAllMove" name="mouseMoveMode" value="0" onclick="changeMouseMove('0');"/>
				<label for="mouseAllMove"> ALL </label>
				<input type="radio" id="mouseObjectMove" name="mouseMoveMode" value="1" onclick="changeMouseMove('1');"/>
				<label for="mouseObjectMove"> Object </label>
			</div>
			<div style="margin-top: 15px;">
				<div style="padding-left: 10px;">
					Location And Rotation
				</div>
				<div style="margin-top: 5px;">
					<span style="padding-left: 102px; padding-right: 12px;">
						<label for="move_data_key">Data Key</label>
						<input type="text" id="move_data_key" name="move_data_key" size="15" />
					</span>
				</div>
				<div style="margin-top: 5px;">
					<span style="padding-left: 110px; padding-right: 12px;">
						<label for="move_latitude">위도 </label>
						<input type="text" id="move_latitude" name="move_latitude" size="15"/> 
					</span> 
				</div>
				<div style="margin-top: 5px;">
					<span style="padding-left: 110px; padding-right: 12px;">
						<label for="move_longitude">경도 </label>
						<input type="text" id="move_longitude" name="move_longitude" size="15"/>
					</span> 
				</div>
				<div style="margin-top: 5px;">
					<span style="padding-left: 110px; padding-right: 12px;">
						<label for="move_height">높이 </label>
						<input type="text" id="move_height" name="move_height" size="15" />
					</span> 
				</div>
				<div style="margin-top: 5px;">
					<span style="padding-left: 97px; padding-right: 12px;">
						<label for="move_heading">HEADING </label>
						<input type="text" id="move_heading" name="move_heading" size="15" />
					</span> 
				</div>
				<div style="margin-top: 5px;">
					<span style="padding-left: 110px; padding-right: 12px;">
						<label for="move_pitch">PITCH </label>
						<input type="text" id="move_pitch" name="move_pitch" size="15" />
					</span>
				</div> 
				<div style="margin-top: 5px;">
					<span style="padding-left: 110px; padding-right: 12px;">
						<label for="move_roll">ROLL </label>
						<input type="text" id="move_roll" name="move_roll" size="15" /> 
						<button type="button" id="changeLocationAndRotationAPI">변환</button>
					</span>
				</div>
			</div>
			<div style="height: 20px;"></div>
		</div>
	</div>

	<div class="shortcut" style="top:60px;">
		<p>바로가기</p>
		<ul>
			<li onclick="flyTo(null, null, '126.60856869381428', '37.58156267183209', '550', '3')">3DS 통합 가시화</li>
			<li onclick="flyTo(null, null, '126.599996', '37.438778', '650', '3')">Sea Port</li>
			<li onclick="flyTo(null, null, '126.738134', '37.663559', '150', '3')">IFC 통합 가시화</li>
			<li onclick="flyTo(null, null, '126.799403', '37.568150', '370', '3')">Collada 통합 가시화</li>
			<li onclick="flyTo(null, null, '-58.787', '-62.224', '200', '5')">KSJ 통합 가시화</li>
		</ul>
	</div>	

	<!-- 맵영역 -->
	<div id="magoContainer" style="position: absolute; width: 100%; height: 100%; margin-top: 0; padding: 0; overflow: hidden;"></div>

	<form id="issue" action="/homepage/demo.do" method="post" onsubmit="return false;">
	<div id="inputIssueLayer" style="display: none; top:40%; left:45%; width:450px; margin:-250px 0 0 -150px; " class="layer">
	    <div class="layerHeader">
	        <h2>Issue Register</h2>
	        <div>
	            <button id="inputIssueClose" type="button" title="닫기">닫기</button>
	        </div>
	    </div>
	    <div class="layerContents">
	        <table>
	        	<tr>
	        		<th style="width: 120px;">
	        			<label for="data_group_id">데이터 그룹</label><span class="icon-glyph glyph-emark-dot color-warning"></span>
	        		</th>
	        		<td>
	        			<select id="data_group_id" name="data_group_id" class="select"><option value="3">3DS</option>
						<option value="9">IFC</option>
						<option value="10">COLLADA</option>
						</select>
					</td>
	        	</tr>
	        	<tr>
	        		<th>
	        			<label for="issue_type">Issue Type</label></th>
	        		<td>
	        			<select id="issue_type" name="issue_type" class="select"><option value="BUGGER">버그</option>
							<option value="IMPROVE">개선</option>
							<option value="NEW">신규</option>
							<option value="ETC">기타</option>
							</select>
					</td>
	        	</tr>
	        	<tr>
	        		<th>
	        			<label for="data_key">Data Key</label><span class="icon-glyph glyph-emark-dot color-warning"></span>
	        		</th>
	        		<td>
	        			<input id="data_key" name="data_key" class="ml" type="text" value=""/>
	        			<input id="object_key" name="object_key" type="hidden" value=""/>
	        			<input id="latitude" name="latitude" type="hidden" value=""/>
	        			<input id="longitude" name="longitude" type="hidden" value=""/>
	        			<input id="height" name="height" type="hidden" value=""/>
	        		</td>
	        	</tr>
	        	<tr>
	        		<th>
	        			<label for="title">제목</label><span class="icon-glyph glyph-emark-dot color-warning"></span>
	        		</th>
	        		<td><input id="title" name="title" class="ml" type="text" value=""/></td>
	        	</tr>
	        	<tr>
	        		<th><label for="priority">Issue Priority</label></th>
	        		<td>
	        			<select id="priority" name="priority" class="select"><option value="CRITICAL">긴급</option>
							<option value="MUST">보통</option>
							<option value="MINOR">낮음</option>
							<option value="TRIVIAL">매우낮음</option>
							</select>
					</td>
	        	</tr>
	        	<tr>
	        		<th><label for="due_date">마감일</label></th>
	        		<td><input id="start_date" name="start_date" type="hidden" value=""/><input type="text" id="start_day" name="start_day" placeholder="날짜" size="7" maxlength="4" />
						<input type="text" id="start_hour" name="start_hour" placeholder="시간" size="3" maxlength="2" />
						<span class="delimeter">:</span>
						<input type="text" id="start_minute" name="start_minute" placeholder="분" size="3" maxlength="2" />
	        		</td>
	        	</tr>
	        	<tr>
	        		<th><label for="assignee">Assignee</label></th>
	        		<td><input id="assignee" name="assignee" class="m" placeholder="대리자" type="text" value=""/></td>
	        	</tr>
	        	<tr>
	        		<th><label for="reporter">reporter</label></th>
	        		<td><input id="reporter" name="reporter" class="m" placeholder="보고 해야 하는 사람" type="text" value=""/></td>
	        	</tr>
	        	<tr style="height: 50px;">
	        		<th><label for="contents">내용</label></th>
	        		<td>
	        			<textarea id="contents" name="contents"></textarea></td>
				</tr>
	        </table>
	        
	      	<div class="btns">
	 			<button id="issueInsertButton">Save</button>
			</div>
	    </div>
	</div>
	</form>
	
	<ul class="controlStick">
		<li>
			<span id="moveForwardImage"><img src="/images/ko/plus.png" alt="plus" /></span>
			<span id="moveRightImage"><img src="/images/ko/rotate_right.png" alt="rotate right" /></span>
			<span id="moveUpImage"><img src="/images/ko/pitch_up.png" alt="plus" /></span>
		</li>
		<li>
			<span id="moveBackwardImage"><img src="/images/ko/minus.png" alt="minus" /></span>
			<span id="moveLeftImage"><img src="/images/ko/rotate_left.png" alt="rotate left" /></span>
			<span id="moveDownImage"><img src="/images/ko/pitch_down.png" alt="down" /></span>
		</li>
	</ul>

<script type="text/javascript" src="/src/engine/cesium/Cesium.js"></script>
<!-- <script type="text/javascript" src="/build/mago3d/mago3d.js"></script> -->
<script type="text/javascript" src="/src/mago3d/core/Atmosphere.js"></script>
<script type="text/javascript" src="/src/mago3d/core/AuxiliarSegment.js"></script>
<script type="text/javascript" src="/src/mago3d/core/BoundingBox.js"></script>
<script type="text/javascript" src="/src/mago3d/core/BoundingSphere.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Box.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Camera.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Code.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Color.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Constant.js"></script>
<script type="text/javascript" src="/src/mago3d/core/FBO.js"></script>
<script type="text/javascript" src="/src/mago3d/core/FileRequestControler.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Frustum.js"></script>
<script type="text/javascript" src="/src/mago3d/core/GeographicCoord.js"></script>
<script type="text/javascript" src="/src/mago3d/core/GeoLocationData.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Geometry.js"></script>
<script type="text/javascript" src="/src/mago3d/core/GeometryModifier.js"></script>
<script type="text/javascript" src="/src/mago3d/core/GlobeTile.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Line.js"></script>
<script type="text/javascript" src="/src/mago3d/core/MagoManager.js"></script>
<script type="text/javascript" src="/src/mago3d/core/ManagerFactory.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Matrix4.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Message.js"></script>
<script type="text/javascript" src="/src/mago3d/core/ObjectMarker.js"></script>
<script type="text/javascript" src="/src/mago3d/core/OcclusionCullOctree.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Pin.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Plane.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Point3D.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Quaternion.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Sphere.js"></script>
<script type="text/javascript" src="/src/mago3d/core/SplitValue.js"></script>
<script type="text/javascript" src="/src/mago3d/core/TerranTile.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Texture.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Triangle.js"></script>
<script type="text/javascript" src="/src/mago3d/core/TriPolyhedron.js"></script>
<script type="text/javascript" src="/src/mago3d/core/TriSurface.js"></script>
<script type="text/javascript" src="/src/mago3d/core/VBOManager.js"></script>
<script type="text/javascript" src="/src/mago3d/core/Vertex.js"></script>
<script type="text/javascript" src="/src/mago3d/core/VertexList.js"></script>
<script type="text/javascript" src="/src/mago3d/core/VertexMatrix.js"></script>
<script type="text/javascript" src="/src/mago3d/core/VisibleObjectsController.js"></script>
<script type="text/javascript" src="/src/mago3d/domain/API.js"></script>
<script type="text/javascript" src="/src/mago3d/domain/Callback.js"></script>
<script type="text/javascript" src="/src/mago3d/domain/Config.js"></script>
<script type="text/javascript" src="/src/mago3d/domain/MagoFacade.js"></script>
<script type="text/javascript" src="/src/mago3d/domain/Policy.js"></script>
<script type="text/javascript" src="/src/mago3d/domain/ProjectLayer.js"></script>

<script type="text/javascript" src="/src/mago3d/f4d/Accessor.js"></script>
<script type="text/javascript" src="/src/mago3d/f4d/BlockModels.js"></script>
<script type="text/javascript" src="/src/mago3d/f4d/Lego.js"></script>
<script type="text/javascript" src="/src/mago3d/f4d/MetaData.js"></script>
<script type="text/javascript" src="/src/mago3d/f4d/NeoReferenceModels.js"></script>
<script type="text/javascript" src="/src/mago3d/f4d/NeoTexture.js"></script>
<script type="text/javascript" src="/src/mago3d/f4d/Octree.js"></script>
<script type="text/javascript" src="/src/mago3d/f4d/ReaderWriter.js"></script>
<script type="text/javascript" src="/src/mago3d/renderer/Renderer.js"></script>
<script type="text/javascript" src="/src/mago3d/renderer/SceneState.js"></script>
<script type="text/javascript" src="/src/mago3d/renderer/Selection.js"></script>
<script type="text/javascript" src="/src/mago3d/shader/PostFxShader.js"></script>
<script type="text/javascript" src="/src/mago3d/shader/Shader.js"></script>
<script type="text/javascript" src="/src/mago3d/shader/ShaderSource.js"></script>
<script type="text/javascript" src="/src/mago3d/util/DefaultValue.js"></script>
<script type="text/javascript" src="/src/mago3d/util/GeometryUtil.js"></script>
<script type="text/javascript" src="/src/mago3d/util/ManagerUtils.js"></script>
<script type="text/javascript" src="/src/mago3d/worker/MultiThread.js"></script>
<script type="text/javascript" src="/src/mago3d/worker/WebWorker.js"></script>
<script type="text/javascript" src="/src/mago3d/extern/tga.js"></script>
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('chrome') < 0) { 
		alert("이 데모 페이지는 대용량 웹 데이터 처리를 위해 Chrome 브라우저에 최적화 되어 있습니다. \n원활한 서비스 이용을 위해 Chrome 브라우저를 이용  하시기 바랍니다.");
	}

	var managerFactory = null;
	var insertIssueFlag = false;
	var objectInfoViewFlag = false;
	var listIssueFlag = false;
	var imagePath = "/images/ko";
	magoStart(null, "magoContainer", null, null);
	var intervalCount = 0;
	var timerId = setInterval("startMogoUI()", 1000);
	
	function startMogoUI() {
		intervalCount++;
		if(managerFactory != null) {
			// BoundingBox
			changeBoundingBox(false);
			// Selecting And Moving
			changeMouseMove("2");
			clearInterval(timerId);
			console.log(" managerFactory != null, intervalCount = " + intervalCount);
			return;
		}
		console.log("--------- intervalCount = " + intervalCount);
	}
	
	// mago3d 시작, 정책 데이터 파일을 로딩
	function magoStart(viewer, renderDivId, imagePath) {
		$.ajax({
			url: "/sample/policy-cesium.json",
			type: "GET",
			dataType: "json",
			success: function(serverPolicy){
				loadData(viewer, renderDivId, serverPolicy);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
		
	function loadData(viewer, renderDivId, serverPolicy) {
		$.ajax({
			url: "/sample/data.json",
			type: "GET",
			dataType: "json",
			success: function(serverData){
				managerFactory = new ManagerFactory(viewer, renderDivId, serverPolicy, serverData, imagePath);
			},
			error: function(e){
				alert(e.responseText);
			}
		});
	}
	
	$("#issueMoreImage").click(function() {
		if($("#recentIssueListContent").css("display") == "none") {
			$("#issueMoreImage").addClass("on");
			$("#apiMoreImage").removeClass("on");
			$("#recentIssueListContent").show();
			$("#apiListContent").hide();
		} else {
			$("#issueMoreImage").removeClass("on");
			$("#recentIssueListContent").hide();
		}
	});
	$("#apiMoreImage").click(function() {
		if($("#apiListContent").css("display") == "none") {
			$("#apiMoreImage").addClass("on");
			$("#issueMoreImage").removeClass("on");
			$("#apiListContent").show();
			$("#recentIssueListContent").hide();
		} else {
			$("#apiMoreImage").removeClass("on");
			$("#apiListContent").hide();
		}
	});
	
	function flyTo(issueId, issueType, longitude, latitude, height, duration) {
		managerFactory.flyTo(issueId, issueType, longitude, latitude, height, duration);
		// 현재 좌표를 저장
		$("#now_latitude").val(latitude);
		$("#now_longitude").val(longitude);
	}
	
	// 이슈 등록
	$("#issueEnable").click(function() {
		if(insertIssueFlag) {
			insertIssueFlag = false;
			$("#issueEnable").removeClass("on");
		} else {
			insertIssueFlag = true;
			$("#issueEnable").addClass("on");
		}
		changeInsertIssueModeAPI(insertIssueFlag);
	});
	// object info 표시
	$("#objectInfoEnable").click(function() {
		if(objectInfoViewFlag) {
			objectInfoViewFlag = false;
			$("#objectInfoEnable").removeClass("on");
		} else {
			objectInfoViewFlag = true;
			$("#objectInfoEnable").addClass("on");			
		}
		changeObjectInfoViewModeAPI(objectInfoViewFlag);
	});
	// issue list 표시
	$("#issuesEnable").click(function() {
		if(listIssueFlag) {
			listIssueFlag = false;
			$("#issuesEnable").removeClass("on");
		} else {
			listIssueFlag = true;
			$("#issuesEnable").addClass("on");
			
			// 현재 위치의 latitude, logitude를 가지고 가장 가까이에 있는 데이터 그룹에 속하는 이슈 목록을 최대 100건 받아서 표시
			var now_latitude = $("#now_latitude").val();
			var now_longitude = $("#now_longitude").val();
			var info = "latitude=" + now_latitude + "&longitude=" + now_longitude;		
			$.ajax({
				url: "/issue/ajax-list-issue-by-geo.do",
				type: "GET",
				data: info,
				dataType: "json",
				success: function(msg){
					if(msg.result == "success") {
						var issueList = msg.issueList;
						if(issueList != null && issueList.length > 0) {
							for(i=0; i<issueList.length; i++ ) {
								var issue = issueList[i];
								drawInsertIssueImageAPI(0, issue.issue_id, issue.issue_type, issue.data_key, issue.latitude, issue.longitude, issue.height);
							}
						}
					} else {
						alert(JS_MESSAGE[msg.result]);
					}
				},
				error:function(request,status,error){
			        //alert(JS_MESSAGE["ajax.error.message"]);
					console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
				}
			});
		}
		changeListIssueViewModeAPI(listIssueFlag);
	});
	
	// issue input layer call back function
	function showInsertIssueLayer(data_key, object_key, latitude, longitude, height) {
		if(insertIssueFlag) {
			if($("#inputIssueLayer").css("display") == "none") {
				$("#inputIssueLayer").show();
				
				$("#data_key").val(data_key);
				$("#object_key").val(object_key);
				$("#latitude").val(latitude);
				$("#longitude").val(longitude);
				$("#height").val(height);
				
				// 현재 좌표를 저장
				$("#now_latitude").val(latitude);
				$("#now_longitude").val(longitude);
			}
		}
	}
	
	function check() {
		if ($("#data_key").val() == "") {
			alert(JS_MESSAGE["issue.datakey.empty"]);
			$("#data_key").focus();
			return false;
		}
		if ($("#title").val() == "") {
			alert(JS_MESSAGE["issue.title.empty"]);
			$("#title").focus();
			return false;
		}
		/* if ($("#assignee").val() == "") {
			alert(JS_MESSAGE["issue.assignee.empty"]);
			$("#assignee").focus();
			return false;
		}
		if ($("#reporter").val() == "") {
			alert(JS_MESSAGE["issue.reporter.empty"]);
			$("#reporter").focus();
			return false;
		} */
		if ($("#contents").val() == "") {
			alert(JS_MESSAGE["issue.contents.empty"]);
			$("#contents").focus();
			return false;
		}
		if ($("#start_hour").val() > 23) {
			alert(JS_MEESAGE["issue.start_hour.proper"]);
			$("#start_hour").focus();
			return false;
		}
		if ($("#start_minute").val() > 59) {
			alert(JS_MESSAGE["issue.start_minute.proper"]);
			$("#start_minute").focus();
			return false;
		}
	}
	
	var isInsertIssue = true;
	$("#issueInsertButton").click(function() {
		if (check() == false) {
			return false;
		}
		if(isInsertIssue) {
			isInsertIssue = false;
			var info = $("#issue").serialize();		
			$.ajax({
				url: "/issue/ajax-insert-issue.do",
				type: "POST",
				data: info,
				cache: false,
				dataType: "json",
				success: function(msg){
					if(msg.result == "success") {
						alert(JS_MESSAGE["insert"]);
						// pin image를 그림
						drawInsertIssueImageAPI(1, msg.issue.issue_id, msg.issue.issue_type, $("#data_key").val(), $("#latitude").val(), $("#longitude").val(), $("#height").val());
					} else {
						alert(JS_MESSAGE[msg.result]);
					}
					
					$("#inputIssueLayer").hide();
					isInsertIssue = true;
					ajaxIssueList();
				},
				error:function(request,status,error){
			        //alert(JS_MESSAGE["ajax.error.message"]);
			        alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
			        isInsertIssue = true;
				}
			});
			
			changeInsertIssueStateAPI(0);
		} else {
			alert(JS_MESSAGE["button.dobule.click"]);
			return;
		}
	});
	
	$("#inputIssueClose").click(function() {
		$("#inputIssueLayer").hide();
		changeInsertIssueStateAPI(0);
	});
	
	// object 정보 표시 call back function
	function showSelectedObject(projectId, blockId, objectId, latitude, longitude, height, heading, pitch, roll){
		if(objectInfoViewFlag) {
			$("#move_data_key").val(projectId + "_" + blockId);
			$("#move_latitude").val(latitude);
			$("#move_longitude").val(longitude);
			$("#move_height").val(height);
			$("#move_heading").val(heading);
			$("#move_pitch").val(pitch);
			$("#move_roll").val(roll);
			
			$.toast({
			    heading: 'Click Object Info',
			    text: [
			        'projectId : ' + projectId, 
			        'blockId : ' + blockId, 
			        'objectId : ' + objectId,
			        'latitude : ' + latitude,
			        'longitude : ' + longitude,
			        'height : ' + height,
			        'heading : ' + heading,
			        'pitch : ' + pitch,
			        'roll : ' + roll
			    ],
				//bgColor : 'blue',
				hideAfter: 5000,
				icon: 'info'
			});
			
			// 현재 좌표를 저장
			$("#now_latitude").val(latitude);
			$("#now_longitude").val(longitude);
		}
	}
	
	// Data 검색
	$("#searchData").click(function() {
		if ($.trim($("#search_data_key").val()) === ""){
			alert("Data Key를 입력해 주세요.");
			$("#search_data_key").focus();
			return false;
		}
		searchDataAPI($("#search_data_key").val());
	});
	// boundingBox 표시/비표시
	function changeBoundingBox(isShow) {
		$("input:radio[name='boundingBox']:radio[value='" + isShow + "']").prop("checked", true);
		changeBoundingBoxAPI(isShow);
	}
	// 마우스 클릭 객체 이동 모드 변경
	function changeMouseMove(mouseMoveMode) {
		$("input:radio[name='mouseMoveMode']:radio[value='" + mouseMoveMode + "']").prop("checked", true);
		changeMouseMoveAPI(mouseMoveMode);
	}
	// 변환행렬
	$("#changeLocationAndRotationAPI").click(function() {
		if(!changeLocationAndRotationCheck()) return false;
		changeLocationAndRotationAPI(	$("#move_data_key").val(), $("#move_latitude").val(), $("#move_longitude").val(), 
										$("#move_height").val(), $("#move_heading").val(), $("#move_pitch").val(), $("#move_roll").val());
	});
	function changeLocationAndRotationCheck() {
		if ($.trim($("#move_data_key").val()) === ""){
			alert("Data Key를 입력해 주세요.");
			$("#move_data_key").focus();
			return false;
		}
		if ($.trim($("#move_latitude").val()) === ""){
			alert("위도를 입력해 주세요.");
			$("#move_latitude").focus();
			return false;
		}
		if ($.trim($("#move_longitude").val()) === ""){
			alert("경도를 입력해 주세요.");
			$("#move_longitude").focus();
			return false;
		}
		if ($.trim($("#move_height").val()) === ""){
			alert("높이를 입력해 주세요.");
			$("#move_height").focus();
			return false;
		}
		if ($.trim($("#move_heading").val()) === ""){
			alert("heading을 입력해 주세요.");
			$("#move_heading").focus();
			return false;
		}
		if ($.trim($("#move_pitch").val()) === ""){
			alert("pitch를 입력해 주세요.");
			$("#move_pitch").focus();
			return false;
		}
		if ($.trim($("#move_roll").val()) === ""){
			alert("roll를 입력해 주세요.");
			$("#move_roll").focus();
			return false;
		}
		return true;
	}
	
	// TODO issue url 밑에 있어야 할지도 모르겠다.
	function ajaxIssueList() {
		var info = "";		
		$.ajax({
			url: "/homepage/ajax-list-issue.do",
			type: "GET",
			data: info,
			dataType: "json",
			success: function(msg){
				if(msg.result == "success") {
					var issueList = msg.issueList;
					var content = "";
					
					if(issueList == null || issueList.length == 0) {
						content += 	"<li style=\"text-align: center; padding-top:20px; height: 50px;\">"
								+	"	Issue가 존재하지 않습니다."
								+	"</li>";
					} else {
						for(i=0; i<issueList.length; i++ ) {
							var issue = issueList[i];
							var issueTypeCss = "i1";
							var issuePriorityCss = "t1";
							if(issue.issue_type == "BUGGER") {
								issueTypeCss = "i1";
							} else if(issue.issue_type == "IMPROVE") {
								issueTypeCss = "i2";
							} else if(issue.issue_type == "NEW") {
								issueTypeCss = "i3";
							} else if(issue.issue_type == "ETC") {
								issueTypeCss = "i4";
							}
							
							if(issue.priority == "CRITICAL") {
								issuePriorityCss = "t1";
							} else if(issue.priority == "MUST") {
								issuePriorityCss = "t2";
							} else if(issue.priority == "MINOR") {
								issuePriorityCss = "t3";
							} else if(issue.priority == "TRIVIAL") {
								issuePriorityCss = "t4";
							}
							
							content = content 
								+ 	"<li>"
								+ 	"	<p class=\"title\">" + issue.title  + "</p>"
								+ 	"	<p class=\"info\">"
								+ 	"		<span class=\"tag " + issueTypeCss + "\">" + issue.issue_type_name + "</span>"
								+ 	"		<span class=\"tag " + issuePriorityCss + "\">" + issue.priority_name + "</span>"
								+ 	"		<span>[" + issue.data_group_name + "]</span>"
								+ 	"		<button type=\"button\" title=\"바로가기\""
								+				"onclick=\"flyTo('" + issue.issue_id + "', '" + issue.issue_type + "', '" 
								+ 				issue.longitude + "', '" + issue.latitude + "', '" + issue.height + "', '2')\">바로가기</button>"
								+ 	"		<span class=\"date\">" + issue.insert_date.substring(0,19) + "</span>"
								+	"	</p>"
								+ 	"</li>";
						}
					}
					$("#recentIssueListContent").empty();
					$("#recentIssueListContent").html(content);
				} else {
					alert(JS_MESSAGE[msg.result]);
				}
			},
			error:function(request,status,error){
		        //alert(JS_MESSAGE["ajax.error.message"]);
				console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
			}
		});
	}
	
	$("#moveForwardImage").click(function() {
		mouseMoveAPI("moveForward");
	});
	$("#moveBackwardImage").click(function() {
		mouseMoveAPI("moveBackward");
	});
	$("#moveRightImage").click(function() {
		mouseMoveAPI("moveRight");
	});
	$("#moveLeftImage").click(function() {
		mouseMoveAPI("moveLeft");
	});
	$("#moveUpImage").click(function() {
		mouseMoveAPI("moveUp");
	});
	$("#moveDownImage").click(function() {
		mouseMoveAPI("moveDown");
	});
</script>
</body>
</html>